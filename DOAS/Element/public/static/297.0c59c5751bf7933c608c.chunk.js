"use strict";(self.webpackChunkautomata_neural_nexus_portal=self.webpackChunkautomata_neural_nexus_portal||[]).push([[297],{297:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var a=s(4848),n=s(6540),i=s(2102);s(3072);const r=()=>{const[e,t]=(0,n.useState)(0),[s,r]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),[c,d]=(0,n.useState)(null),[u,p]=(0,n.useState)(!1),[m,h]=(0,n.useState)({}),[f,x]=(0,n.useState)(72),[g,b]=(0,n.useState)(!1),[v,j]=(0,n.useState)(!0),[y,N]=(0,n.useState)(!1),[_,w]=(0,n.useState)(null),O=["Setpoint","Inputs","Outputs","Alarms"];(0,n.useEffect)(()=>{(async()=>{try{const e=await fetch("/api/setpoint");if(e.ok){const t=await e.json();void 0!==t.setpoint&&null!==t.setpoint?x(t.setpoint):(x(72),fetch("/api/setpoint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setpoint:72})})),void 0!==t.autoMode&&N(t.autoMode)}}catch(e){console.error("Error loading setpoint:",e),x(72)}})()},[]),(0,n.useEffect)(()=>{const e=async()=>{try{const e=await fetch("/api/weather");if(e.ok){const t=await e.json();t.temperature&&w(t.temperature)}}catch(e){console.error("Error fetching outdoor temp:",e)}};e();const t=setInterval(e,3e5);return()=>clearInterval(t)},[]),(0,n.useEffect)(()=>{if(y&&null!==_){let e=f;_>60?e=68:_<59&&(e=72),e!==f&&(console.log(`Auto adjusting setpoint: OAT=${_}°F, Setting to ${e}°F`),x(e),j(!1),k(e))}},[y,_]),(0,n.useEffect)(()=>{const e=async()=>{try{const e=await fetch("/api/boards/current-readings");if(e.ok){const t=await e.json();console.log("Fetched data:",t),console.log("Number of inputs:",Object.keys(t.inputs||{}).length);try{const e=await fetch("/api/vibration/readings");if(e.ok){const s=await e.json();"object"!=typeof s||Array.isArray(s)?Array.isArray(s)&&s.forEach(e=>{e.sensor_id&&void 0!==e.velocity_mms&&(t.inputs[`vib_${e.sensor_id}_velocity`]=e.velocity_mms,t.inputs[`vib_${e.sensor_id}_temp`]=e.temperature_f)}):Object.entries(s).forEach(([e,s])=>{s&&void 0!==s.velocity_mms&&(t.inputs[`vib_${e}_velocity`]=s.velocity_mms,t.inputs[`vib_${e}_temp`]=s.temperature_f)})}}catch(e){console.error("Failed to fetch vibration readings:",e)}const s=localStorage.getItem("nodeRedOutputLabels");s&&(t.labels=JSON.parse(s)),r(t),d(null)}else d("Failed to fetch board readings")}catch(e){d("Connection error")}finally{o(!1)}};e();const t=setInterval(e,1e4);return()=>clearInterval(t)},[]);const S=e=>{x(e),j(!1)},k=async e=>{try{(await fetch("/api/setpoint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setpoint:e,autoMode:y})})).ok&&(console.log("Setpoint saved:",e),j(!0))}catch(e){console.error("Error saving setpoint:",e)}},F=async()=>{b(!0);try{(await fetch("/api/setpoint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setpoint:f,autoMode:y})})).ok?(console.log("Setpoint saved:",f),j(!0),setTimeout(()=>{b(!1)},1500)):(console.error("Failed to save setpoint"),b(!1))}catch(e){console.error("Error saving setpoint:",e),b(!1)}},C=()=>{const e=!y;N(e),fetch("/api/setpoint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setpoint:f,autoMode:e})})},T=(e,t,s)=>{h(a=>({...a,[e]:{...a[e],[t]:s}}))};return(0,n.useEffect)(()=>{const e=localStorage.getItem("nodeRedOutputLabels");if(e){const t=JSON.parse(e);h(t)}},[]),l?(0,a.jsx)("div",{className:"nodered-readings-card",children:(0,a.jsx)("div",{className:"readings-loading",children:(0,a.jsx)("div",{className:"spinner"})})}):(0,a.jsxs)("div",{className:"nodered-readings-card",children:[(0,a.jsxs)("div",{className:"readings-header",children:[(0,a.jsx)("button",{className:"nav-btn",onClick:()=>{t(e=>(e-1+O.length)%O.length)},children:(0,a.jsx)("i",{className:"fas fa-chevron-left"})}),(0,a.jsx)("h3",{style:{flex:1,textAlign:"center"},children:O[e]}),2===e&&(u?(0,a.jsx)("button",{className:"edit-btn",onClick:()=>{localStorage.setItem("nodeRedOutputLabels",JSON.stringify(m)),p(!1),s&&r({...s,labels:m})},title:"Save Labels",children:(0,a.jsx)("i",{className:"fas fa-save"})}):(0,a.jsx)("button",{className:"edit-btn",onClick:()=>p(!0),title:"Edit Labels",children:(0,a.jsx)("i",{className:"fas fa-edit"})})),(0,a.jsx)("button",{className:"nav-btn",onClick:()=>{t(e=>(e+1)%O.length)},children:(0,a.jsx)("i",{className:"fas fa-chevron-right"})})]}),(0,a.jsx)("div",{className:"card-indicators",children:O.map((s,n)=>(0,a.jsx)("span",{className:"indicator "+(n===e?"active":""),onClick:()=>t(n)},n))}),c?(0,a.jsxs)("div",{className:"readings-error",children:[(0,a.jsx)("i",{className:"fas fa-exclamation-circle"}),(0,a.jsx)("span",{children:c})]}):(()=>{switch(e){case 0:return(0,a.jsxs)("div",{className:"setpoint-control",children:[(0,a.jsxs)("div",{className:"setpoint-display",children:[(0,a.jsx)("h4",{children:"System Setpoint"}),(0,a.jsxs)("div",{className:"setpoint-value",children:[(0,a.jsx)("span",{className:"setpoint-number",children:f}),(0,a.jsx)("span",{className:"setpoint-unit",children:"°F"})]}),null!==_&&(0,a.jsxs)("div",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px"},children:["OAT: ",_,"°F"]})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",marginBottom:"15px"},children:[(0,a.jsx)("label",{style:{fontSize:"14px",fontWeight:500,color:y?"#14b8a6":"#6b7280"},children:"Auto Mode"}),(0,a.jsx)("button",{onClick:C,style:{width:"50px",height:"24px",borderRadius:"12px",border:"none",background:y?"#14b8a6":"#cbd5e1",position:"relative",cursor:"pointer",transition:"background 0.3s"},children:(0,a.jsx)("div",{style:{width:"20px",height:"20px",borderRadius:"10px",background:"white",position:"absolute",top:"2px",left:y?"28px":"2px",transition:"left 0.3s",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}})}),(0,a.jsx)("span",{style:{fontSize:"11px",color:"#6b7280",marginLeft:"5px"},children:y?"OAT>60°=68° | OAT<59°=72°":"Manual"})]}),(0,a.jsxs)("div",{className:"setpoint-adjuster",children:[(0,a.jsx)("button",{className:"setpoint-btn decrease",onClick:()=>S(Math.max(50,f-1)),children:(0,a.jsx)("i",{className:"fas fa-minus"})}),(0,a.jsx)("input",{type:"range",className:"setpoint-slider",min:"50",max:"90",value:f,onChange:e=>S(Number(e.target.value))}),(0,a.jsx)("button",{className:"setpoint-btn increase",onClick:()=>S(Math.min(90,f+1)),children:(0,a.jsx)("i",{className:"fas fa-plus"})})]}),(0,a.jsxs)("div",{className:"setpoint-presets",children:[(0,a.jsx)("button",{className:"preset-btn",onClick:()=>S(68),children:"68°F"}),(0,a.jsx)("button",{className:"preset-btn",onClick:()=>S(70),children:"70°F"}),(0,a.jsx)("button",{className:"preset-btn",onClick:()=>S(72),children:"72°F"}),(0,a.jsx)("button",{className:"preset-btn",onClick:()=>S(75),children:"75°F"})]}),(0,a.jsx)("div",{className:"setpoint-save-container",children:(0,a.jsx)(i.$,{variant:"teal",size:"default",onClick:F,disabled:g||v,className:"save-setpoint-btn",style:{backgroundColor:"rgba(203, 213, 225, 0.2)",color:"#14b8a6",border:"1px solid rgba(20, 184, 166, 0.2)",width:"100%",marginTop:"12px",fontSize:"14px",fontWeight:"500",height:"36px"},children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-spinner fa-spin",style:{marginRight:"8px"}}),"Saving..."]}):v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-check",style:{marginRight:"8px"}}),"Saved"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"fas fa-save",style:{marginRight:"8px"}}),"Save Setpoint"]})})})]});case 1:return(()=>{if(!s||!s.inputs)return console.log("No data or inputs available"),null;console.log("Rendering inputs:",Object.keys(s.inputs).length,"items"),console.log("Input keys:",Object.keys(s.inputs)),console.log("Full input data:",s.inputs);const e=e=>{let t=e.replace(/_0_10v_0_\d+a/g,"").replace(/_1k_rtd/g,"").replace(/_10k/g,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return t=t.replace(/Vfd/g,"VFD").replace(/Hp/g,"HP").replace(/Oat/g,"OAT").replace(/L1/g,"L1").replace(/L3/g,"L3").replace(/Temp/g,"Temp"),t},t=e=>e.includes("setpoint")?"fas fa-crosshairs":e.includes("vib_")&&e.includes("velocity")?"fas fa-wave-square":e.includes("vib_")&&e.includes("temp")?"fas fa-thermometer-half":e.includes("current")||e.includes("amps")?"fas fa-bolt":e.includes("temp")||e.includes("oat")?"fas fa-thermometer-half":e.includes("supply")?"fas fa-wind":e.includes("return")?"fas fa-reply":e.includes("tower")?"fas fa-building":e.includes("pump")?"fas fa-tint":e.includes("space")?"fas fa-home":"fas fa-chart-line",n=(e,t)=>{if(null==t)return"--";let s=parseFloat(t);if(isNaN(s))return t;const a=e.toLowerCase();if(a.includes("current")&&a.includes("0_10v_0_50a")&&(a.includes("tower_2")&&a.includes("l1")?s=Math.max(0,s-2.01):a.includes("tower_2")&&a.includes("l3")?s=Math.max(0,s-3.865):a.includes("tower_3")&&a.includes("l1")?s=Math.max(0,s-3.255):a.includes("tower_3")&&a.includes("l3")&&(s=Math.max(0,s-7.685))),e.includes("vib_")&&e.includes("velocity"))return`${s.toFixed(2)} mm/s`;if(e.includes("vib_")&&e.includes("temp"))return`${s.toFixed(1)}°F`;if(e.includes("current")||e.includes("amps")||e.includes("l1")||e.includes("l3"))return`${s.toFixed(1)}A`;if(e.includes("voltage"))return`${s.toFixed(1)}V`;if(e.includes("pressure"))return`${s.toFixed(1)} PSI`;if(e.includes("humidity"))return`${s.toFixed(0)}%`;if(s>900&&s<1200){const e=(Math.sqrt(.00644*s-1.6597)-1.961)/.00322;return`${Math.max(-40,Math.min(250,e)).toFixed(1)}°F`}return e.includes("temp")||e.includes("supply")||e.includes("return")||e.includes("oat")||e.includes("space")?`${s.toFixed(1)}°F`:s.toFixed(1)};console.log("About to sort inputs, total:",Object.entries(s.inputs).length);const i=Object.entries(s.inputs).filter(([e])=>"amps"!==e).sort(([e],[t])=>{const s=e.toLowerCase(),a=t.toLowerCase(),n=e=>"setpoint"===e?1:e.includes("outdoor_air_temp")?2:e.includes("hp_loop_supply_temp")?3:e.includes("hp_loop_return_temp")?4:e.includes("tower_supply_temp")?5:e.includes("tower_return_temp")?6:e.includes("pump_1_current")?7:e.includes("pump_2_current")?8:e.includes("pump_3_current")?9:e.includes("tower_1_vfd_current_l1")?10:e.includes("tower_1_vfd_current_l3")?11:e.includes("tower_2_vfd_current_l1")?12:e.includes("tower_2_vfd_current_l3")?13:e.includes("tower_3_vfd_current_l1")?14:e.includes("tower_3_vfd_current_l3")?15:e.includes("vfd_current_7")?16:e.includes("vfd_current_8")?17:99,i=n(s),r=n(a);return i!==r?i-r:e.localeCompare(t)});return(0,a.jsx)("div",{className:"readings-content scrollable",style:{maxHeight:"400px",overflowY:"auto"},children:i.map(([s,i])=>(0,a.jsxs)("div",{className:"reading-item",children:[(0,a.jsx)("i",{className:t(s)}),(0,a.jsx)("span",{className:"reading-label",children:e(s)}),(0,a.jsx)("span",{className:"reading-value",children:n(s,i)})]},s))})})();case 2:return(()=>{if(!s)return null;const e={triac1:"Triac 1",triac2:"Triac 2",triac3:"Triac 3",triac4:"Triac 4"},t={ao1:"AO 1",ao2:"AO 2",ao3:"AO 3",ao4:"AO 4"},n={};for(let e=1;e<=16;e++)n[`relay${e}`]=`Relay ${e}`;const i=u&&m.triacs?m.triacs:s.labels?.triacs||e,r=u&&m.analog?m.analog:s.labels?.analog||t,l=u&&m.relays?m.relays:s.labels?.relays||n;return u&&0===Object.keys(m).length&&h({triacs:i,analog:r,relays:l}),(0,a.jsxs)("div",{className:"readings-content scrollable",style:{maxHeight:"400px",overflowY:"auto"},children:[(0,a.jsxs)("div",{className:"output-section",children:[(0,a.jsx)("h4",{children:"Digital Outputs (Triacs)"}),Object.entries(s.outputs.triacs).map(([t,s])=>(0,a.jsxs)("div",{className:"reading-item",children:[u?(0,a.jsx)("input",{type:"text",className:"label-edit-input",value:i[t]||"",onChange:e=>T("triacs",t,e.target.value)}):(0,a.jsx)("span",{className:"reading-label",children:i[t]||e[t]}),(0,a.jsx)("span",{className:"triac-status "+(s?"enabled":"disabled"),children:s?"ON":"OFF"})]},t))]}),s.outputs.relays&&Object.keys(s.outputs.relays).length>0&&(0,a.jsxs)("div",{className:"output-section",children:[(0,a.jsx)("h4",{children:"Relay Outputs"}),Object.entries(s.outputs.relays).map(([e,t])=>(0,a.jsxs)("div",{className:"reading-item",children:[u?(0,a.jsx)("input",{type:"text",className:"label-edit-input",value:l[e]||"",onChange:t=>T("relays",e,t.target.value)}):(0,a.jsx)("span",{className:"reading-label",children:l[e]||n[e]||e}),(0,a.jsx)("span",{className:"triac-status "+(t?"enabled":"disabled"),children:t?"ON":"OFF"})]},e))]}),(0,a.jsxs)("div",{className:"output-section",children:[(0,a.jsx)("h4",{children:"Analog Outputs"}),Object.entries(s.outputs.analog).map(([e,s])=>(0,a.jsxs)("div",{className:"reading-item",children:[u?(0,a.jsx)("input",{type:"text",className:"label-edit-input",value:r[e]||"",onChange:t=>T("analog",e,t.target.value)}):(0,a.jsx)("span",{className:"reading-label",children:r[e]||t[e]}),(0,a.jsxs)("div",{className:"analog-display",children:[(0,a.jsxs)("span",{className:"analog-voltage",children:[(.1*s).toFixed(1),"V"]}),(0,a.jsxs)("span",{className:"analog-percent",children:[s,"%"]})]})]},e))]})]})})();case 3:return s?0===s.alarms.length?(0,a.jsxs)("div",{className:"readings-content centered",children:[(0,a.jsx)("i",{className:"fas fa-check-circle alarm-ok"}),(0,a.jsx)("span",{children:"No Active Alarms"})]}):(0,a.jsx)("div",{className:"readings-content scrollable",children:s.alarms.map((e,t)=>{const s=e.status||e.type||"warning";return(0,a.jsxs)("div",{className:`alarm-item ${s}`,children:[(0,a.jsxs)("div",{className:"alarm-header",children:[(0,a.jsx)("i",{className:`fas fa-exclamation-triangle alarm-icon ${s}`}),(0,a.jsx)("span",{className:"alarm-name",children:e.name})]}),(0,a.jsxs)("div",{className:"alarm-details",children:[(0,a.jsxs)("span",{children:["Value: ",e.value.toFixed(1),e.unit?e.unit:""]}),e.threshold&&(0,a.jsxs)("span",{children:["Threshold: ",e.threshold.toFixed(1)]}),e.message&&(0,a.jsx)("span",{children:e.message})]}),(0,a.jsx)("div",{className:"alarm-time",children:new Date(e.timestamp).toLocaleTimeString()})]},e.id||t)})}):null;default:return null}})()]})}},2102:(e,t,s)=>{s.d(t,{$:()=>o});var a=s(4848),n=s(6540),i=s(3362);function r(...e){return e.filter(Boolean).join(" ")}const l=(0,s(2732).F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",teal:"bg-teal-500/10 text-teal-600 hover:bg-teal-500/20 border border-teal-200",sidebar:"w-full justify-start text-left bg-transparent hover:bg-gradient-to-r hover:from-teal-500/10 hover:to-cyan-500/10 transition-all duration-200",sidebarActive:"w-full justify-start text-left bg-gradient-to-r from-teal-500/20 to-cyan-500/20 border-l-3 border-teal-500"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef(({className:e,variant:t,size:s,asChild:n=!1,...o},c)=>{const d=n?i.DX:"button";return(0,a.jsx)(d,{className:r(l({variant:t,size:s,className:e})),ref:c,...o})});o.displayName="Button"}}]);
//# sourceMappingURL=297.0c59c5751bf7933c608c.chunk.js.map