"use strict";(self.webpackChunkautomata_neural_nexus_portal=self.webpackChunkautomata_neural_nexus_portal||[]).push([[304],{3304:(e,t,r)=>{r.r(t),r.d(t,{default:()=>m});var a=r(4848),o=r(6540),s=r(4296),n=r(4696),i=r(4653),l=r(7158),c=r(9107),d=r(1598),p=r(7984),h=r(3495),u=r(2746);const m=()=>{const[e,t]=(0,o.useState)("temperature"),[r,m]=(0,o.useState)([]),[f,x]=(0,o.useState)(8),[g,y]=(0,o.useState)(!1),[b,j]=(0,o.useState)(new Map),[k]=(0,o.useState)({tempHigh:85,tempLow:65,ampsHigh:40,ampsLow:5}),S=async()=>{try{const e=await fetch("/api/boards/current-readings");if(e.ok){const t=await e.json(),r=new Date,a={time:f>8?r.toLocaleString("en-US",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"America/New_York"}):r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZone:"America/New_York"})};if(t.inputs){let e=1;const r=new Map;Object.entries(t.inputs).forEach(([t,o])=>{const s=t.toLowerCase();if(s.includes("supply")&&s.includes("air")||s.includes("tower")&&s.includes("supply"))a.supply=parseFloat(o);else if(s.includes("tower")&&s.includes("return"))a.return=parseFloat(o);else if(s.includes("hp")&&s.includes("supply"))a.hpSupply=parseFloat(o),a.supply||(a.supply=parseFloat(o));else if(s.includes("hp")&&s.includes("return"))a.return||(a.return=parseFloat(o));else if(s.includes("outdoor_air")||s.includes("oat"))a.oat=parseFloat(o);else if("space"===s||s.includes("space_temp"))a.space=parseFloat(o);else if(s.includes("current")||s.includes("amps")||s.includes("vfd")){const s=`amps${e}`;a[s]=parseFloat(o),r.set(s,t),e++}else"setpoint"===s&&(a.setpoint=parseFloat(o))}),r.size>0&&j(r)}t.outputs&&t.outputs.triacs&&(a.triac1=t.outputs.triacs.triac1?1:0,a.triac2=t.outputs.triacs.triac2?1:0,a.triac3=t.outputs.triacs.triac3?1:0,a.triac4=t.outputs.triacs.triac4?1:0),Object.keys(a).length>1&&(y(!0),m(e=>{const t=[...e,a],r=f<=1?1:f<=4?5:15,o=Math.floor(60*f/r);return t.length>o?t.slice(-o):t}))}}catch(e){console.error("Failed to fetch sensor data:",e),y(!1)}};return(0,o.useEffect)(()=>{(async()=>{try{const e=await fetch(`/api/boards/historical-data?hours=${f}`);if(e.ok){const t=await e.json();t&&t.length>0&&(m(t),y(!0))}}catch(e){console.error("Failed to load historical data:",e)}})()},[f]),(0,o.useEffect)(()=>{S();const e=setInterval(S,3e4);return()=>clearInterval(e)},[f]),(0,a.jsxs)("div",{className:"trend-graph-card",children:[(0,a.jsxs)("div",{className:"trend-header",children:[(0,a.jsx)("button",{className:"trend-nav-btn",onClick:()=>{const r=["temperature","amps","triacs"],a=r.indexOf(e);t(r[(a-1+r.length)%r.length])},children:"‹"}),(0,a.jsx)("h3",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:(0,a.jsx)("span",{children:{temperature:"Temperature Trends",amps:"Current Trends",triacs:"VFD Enable Status"}[e]})}),(0,a.jsxs)("div",{className:"trend-controls",children:[(0,a.jsxs)("select",{className:"time-range-select",value:f,onChange:e=>x(Number(e.target.value)),children:[(0,a.jsx)("option",{value:1,children:"1 Hour"}),(0,a.jsx)("option",{value:4,children:"4 Hours"}),(0,a.jsx)("option",{value:8,children:"8 Hours"}),(0,a.jsx)("option",{value:24,children:"24 Hours"})]}),(0,a.jsxs)("div",{className:"trend-status",children:[(0,a.jsx)("span",{className:"status-dot "+(g?"connected":"disconnected")}),g?"Live":"Offline"]})]}),(0,a.jsx)("button",{className:"trend-nav-btn",onClick:()=>{const r=["temperature","amps","triacs"],a=r.indexOf(e);t(r[(a+1)%r.length])},children:"›"})]}),(0,a.jsx)("div",{style:{padding:"1rem"},children:(()=>{if(!g||0===r.length)return(0,a.jsxs)("div",{style:{height:250,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f9fafb",borderRadius:"8px",border:"2px dashed #d1d5db"},children:[(0,a.jsx)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"#9ca3af",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})}),(0,a.jsx)("h3",{style:{marginTop:"1rem",marginBottom:"0.5rem",color:"#6b7280",fontSize:"1.125rem",fontWeight:600},children:"Connect Sensors"}),(0,a.jsx)("p",{style:{color:"#9ca3af",fontSize:"0.875rem",textAlign:"center",maxWidth:"250px"},children:"No sensor data available. Please ensure boards are connected and configured."})]});if("temperature"===e)return(0,a.jsx)(i.u,{width:"100%",height:250,children:(0,a.jsxs)(u.b,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,a.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:(()=>{const e=r.length;return f<=1?Math.max(1,Math.floor(e/6)):f<=4||f<=8?Math.max(1,Math.floor(e/8)):Math.max(1,Math.floor(e/10))})(),angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[50,95],tickFormatter:e=>`${e.toFixed(0)}°F`}),(0,a.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>[`${e?.toFixed(1)}°F`,""]}),(0,a.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,a.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,a.jsx)(l.e,{y:k.tempHigh,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5"}),(0,a.jsx)(l.e,{y:k.tempLow,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5"}),(0,a.jsx)(l.e,{y:70,stroke:"rgba(34, 197, 94, 0.3)",strokeDasharray:"3 3",label:"Setpoint"}),r.some(e=>void 0!==e.supply)&&(0,a.jsx)(d.N,{type:"monotone",dataKey:"supply",stroke:"#fed7aa",strokeWidth:2.5,dot:!1,name:"Supply Air",legendType:"line"}),r.some(e=>void 0!==e.return)&&(0,a.jsx)(d.N,{type:"monotone",dataKey:"return",stroke:"rgba(245, 158, 11, 0.3)",strokeWidth:2.5,dot:!1,name:"Tower Return",legendType:"line"}),r.some(e=>void 0!==e.oat)&&(0,a.jsx)(d.N,{type:"monotone",dataKey:"oat",stroke:"#8b5cf6",strokeWidth:2,dot:!1,name:"Outside Air"}),r.some(e=>void 0!==e.space)&&(0,a.jsx)(d.N,{type:"monotone",dataKey:"space",stroke:"#10b981",strokeWidth:2,dot:!1,name:"Space"}),r.some(e=>void 0!==e.hpSupply)&&(0,a.jsx)(d.N,{type:"monotone",dataKey:"hpSupply",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,dot:!1,name:"HP Loop Supply",legendType:"line"})]})});if("amps"===e){const e=["#f59e0b","#0ea5e9","#10b981","#8b5cf6","#ec4899","#06b6d4"],t=new Set;return r.forEach(e=>{Object.keys(e).forEach(e=>{e.startsWith("amps")&&"amps"!==e&&t.add(e)})}),(0,a.jsx)(i.u,{width:"100%",height:250,children:(0,a.jsxs)(u.b,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,a.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:f<=1?"preserveStartEnd":f<=4?Math.floor(r.length/8):Math.floor(r.length/6),angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[0,50],tickFormatter:e=>`${e.toFixed(0)}A`}),(0,a.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>[`${e?.toFixed(1)}A`,""]}),(0,a.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,a.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,a.jsx)(l.e,{y:k.ampsHigh,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5",label:"High Limit"}),(0,a.jsx)(l.e,{y:k.ampsLow,stroke:"rgba(34, 197, 94, 0.3)",strokeDasharray:"5 5",label:"Running"}),Array.from(t).sort().map((t,r)=>{const o=(b.get(t)||t).replace(/_/g," ").replace(/tower/gi,"Tower").replace(/pump/gi,"Pump").replace(/vfd/gi,"VFD").replace(/current/gi,"").replace(/amps/gi,"").trim();return(0,a.jsx)(d.N,{type:"monotone",dataKey:t,stroke:e[r%e.length],strokeWidth:2.5,dot:!1,name:o||`Current ${r+1}`},t)})]})})}return(0,a.jsx)(i.u,{width:"100%",height:250,children:(0,a.jsxs)(u.b,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,a.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:(()=>{const e=r.length;return f<=1?Math.max(1,Math.floor(e/6)):f<=4||f<=8?Math.max(1,Math.floor(e/8)):Math.max(1,Math.floor(e/10))})(),angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[0,1],ticks:[0,1],tickFormatter:e=>e>.5?"ON":"OFF"}),(0,a.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>e>.5?"ON":"OFF"}),(0,a.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,a.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,a.jsx)(d.N,{type:"stepAfter",dataKey:"triac1",stroke:"#0ea5e9",strokeWidth:2.5,dot:!1,name:"Tower 1 VFD"}),(0,a.jsx)(d.N,{type:"stepAfter",dataKey:"triac2",stroke:"#10b981",strokeWidth:2.5,dot:!1,name:"Tower 2 VFD"}),(0,a.jsx)(d.N,{type:"stepAfter",dataKey:"triac3",stroke:"#f59e0b",strokeWidth:2.5,dot:!1,name:"Tower 3 VFD"}),(0,a.jsx)(d.N,{type:"stepAfter",dataKey:"triac4",stroke:"#8b5cf6",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"Spare"})]})})})()})]})}}}]);
//# sourceMappingURL=304.37cb572e80b98cd2dd86.chunk.js.map